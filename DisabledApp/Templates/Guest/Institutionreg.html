{% load static %}
{% include "Guest/Header.html" %}
<section class="ftco-section bg-light py-5">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <div class="card shadow-lg border-0 rounded-3">
                    <div class="card-body p-5">
                        <h3 class="card-title text-center text-primary mb-4">Institution Registration</h3>
                        <form action="{% url 'institutionreg_process' %}" method="post" enctype="multipart/form-data">
                            {% csrf_token %}
                            
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="form-label fw-semibold" for="institutionname">Institution Name</label>
                                    <input type="text" class="form-control" name="institutionname" id="institutionname" placeholder="Institution Name" required pattern="^[A-Z][a-zA-Z\s]*$" title="First letter should be capitalized and contain only letters and spaces.">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label fw-semibold" for="regnumber">Registration Number</label>
                                    <input type="text" class="form-control" name="regnumber" id="regnumber" placeholder="Reg Number" required pattern="^[a-zA-Z0-9]+$" title="Only alphanumeric characters allowed.">
                                </div>
                            </div>

                            <div class="row g-3 mt-2">
                                <div class="col-md-6">
                                    <label class="form-label fw-semibold" for="email">Email Address</label>
                                    <input type="email" class="form-control" name="email" id="email" placeholder="Email" required>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label fw-semibold" for="contactno">Contact Number</label>
                                    <input type="text" class="form-control" name="contactno" id="contactno" placeholder="Contact Number" required pattern="\d{10}" title="Enter a valid 10-digit number.">
                                </div>
                            </div>

                            <div class="row g-3 mt-2">
                                <div class="col-md-6">
                                    <label class="form-label fw-semibold" for="websiteurl">Website URL</label>
                                    <input type="url" class="form-control" name="websiteurl" id="websiteurl" placeholder="Website URL" required>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label fw-semibold" for="percentage">Percentage</label>
                                    <input type="number" class="form-control" name="percentage" id="percentage" placeholder="Percentage" min="0" max="100" required>
                                </div>
                            </div>

                            <div class="row g-3 mt-2">
                                <div class="col-md-6">
                                    <label class="form-label fw-semibold" for="district">District</label>
                                    <select class="form-select" name="district" id="district" required>
                                        <option value="">-- Select District --</option>
                                        {% for d in district %}
                                            <option value="{{ d.district_id }}">{{ d.district_name }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label fw-semibold" for="location">Location</label>
                                    <select name="location" id="location" class="form-select" required>
                                        <option value="0">-- Select --</option>
                                    </select>
                                </div>
                            </div>

                            <div class="mt-2">
                                <label class="form-label fw-semibold" for="institutiondesc">Description</label>
                                <textarea class="form-control" name="institutiondesc" id="institutiondesc" placeholder="Institution Description" required pattern="^[A-Z][a-zA-Z0-9.,'\s]*$" title="First letter should be capitalized and contain only letters, numbers, spaces, commas, and periods."></textarea>
                            </div>

                            <div class="mt-2">
                                <label class="form-label fw-semibold" for="institutionimage">Institution Image</label>
                                <input type="file" class="form-control" name="institutionimage" id="institutionimage" required>
                            </div>

                            <div class="mt-2">
                                <label class="form-label fw-semibold" for="category">Category</label>
                                <select class="form-select" name="category" id="category" required>
                                    <option value="">-- Select Category --</option>
                                    {% for c in category %}
                                        <option value="{{ c.categoryid }}">{{ c.categoryname }}</option>
                                    {% endfor %}
                                </select>
                            </div>

                            <div class="row g-3 mt-2">
                                <div class="col-md-6">
                                    <label class="form-label fw-semibold" for="username">Username</label>
                                    <input type="text" class="form-control" name="username" id="username" placeholder="Username" required pattern="^[a-zA-Z0-9]+$" title="Only alphanumeric characters allowed.">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label fw-semibold" for="password">Password</label>
                                    <input type="password" class="form-control" name="password" id="password" placeholder="Password" required pattern="(?=.*[A-Z])(?=.*\d)[A-Za-z\d]{6,}" title="Must contain at least one uppercase letter, one number, and be at least 6 characters long.">
                                </div>
                            </div>

                            <div class="mt-4 text-center">
                                <button type="submit" class="btn btn-primary btn-lg w-100">Register</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% include "Guest/Footer.html" %}

<script src="{% static 'Admin/jquery-3.7.1.min.js' %}"></script>

<script>
    $(document).ready(function () {
        $.ajaxSetup({
            headers: { "X-CSRFToken": '{{ csrf_token }}' }
        });

        $("#district").change(function () {
            var districtid = $(this).val();
            $.ajax({
                type: "POST",
                url: '{% url "filllocation" %}',
                data: { did: districtid },
                dataType: "json",
                success: function (data) {
                    $('#location').empty().append('<option value="">-- Select --</option>');
                    $.each(data, function (key, val) {
                        $('#location').append(`<option value="${val.locationid}">${val.locationname}</option>`);
                    });
                }
            });
        });
    });
</script>
